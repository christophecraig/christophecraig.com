---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import ArticleCard from '../../../components/ArticleCard.astro';
import { getCollection } from 'astro:content';
import { useTranslations, stripLangFromSlug } from '../../../i18n/utils';

export async function getStaticPaths() {
  const articles = await getCollection('articles', ({ data }) => data.lang === 'fr' && !data.draft);
  const tags = [...new Set(articles.flatMap((a) => a.data.tags))];
  return tags.map((tag) => ({
    params: { tag },
    props: { articles: articles.filter((a) => a.data.tags.includes(tag)), tag },
  }));
}

const lang = 'fr';
const t = useTranslations(lang);
const { articles, tag } = Astro.props;
const sorted = articles.sort((a: any, b: any) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title={`${t('tags.title')} "${tag}" â€” Christophe Craig`}>
  <h1 class="text-3xl font-bold mb-8 scroll-reveal">{t('tags.title')} <span class="text-accent-green">"{tag}"</span></h1>
  <div class="grid gap-6">
    {sorted.map((article: any) => (
      <ArticleCard
        title={article.data.title}
        description={article.data.description}
        date={article.data.date}
        slug={stripLangFromSlug(article.slug)}
        tags={article.data.tags}
      />
    ))}
  </div>
</BaseLayout>
