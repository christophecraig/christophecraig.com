---
import { getLangFromUrl, useTranslations, getLocalizedPath } from '../i18n/utils';
import LanguageSwitcher from './LanguageSwitcher.astro';
import ThemeToggle from './ThemeToggle.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const navItems = [
  { href: getLocalizedPath('/', lang), label: t('nav.home') },
  { href: getLocalizedPath('/articles/', lang), label: t('nav.articles') },
  { href: getLocalizedPath('/realisations/', lang), label: t('nav.projects') },
  { href: getLocalizedPath('/cv/', lang), label: t('nav.cv') },
  { href: getLocalizedPath(lang === 'fr' ? '/recherche/' : '/search/', lang), label: t('nav.search') },
];
---

<header class="sticky top-0 z-50 bg-bg-light/90 dark:bg-bg-dark/90 backdrop-blur-sm border-b border-text-light/10 dark:border-text-dark/10">
  <nav class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href={getLocalizedPath('/', lang)} class="font-typewriter font-bold text-lg link-underline">
      Christophe Craig
    </a>

    <button id="menu-toggle" class="md:hidden p-2" aria-label="Menu">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <div id="nav-menu" class="hidden md:flex items-center gap-6">
      {navItems.map(({ href, label }) => (
        <a href={href} class="font-sans text-sm link-underline hover:text-accent-green transition-colors">
          {label}
        </a>
      ))}
      <LanguageSwitcher />
      <ThemeToggle />
    </div>
  </nav>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="hidden md:hidden px-4 pb-4 space-y-2">
    {navItems.map(({ href, label }) => (
      <a href={href} class="block font-sans text-sm py-1 link-underline hover:text-accent-green transition-colors">
        {label}
      </a>
    ))}
    <div class="flex items-center gap-4 pt-2">
      <LanguageSwitcher />
      <ThemeToggle />
    </div>
  </div>
</header>

<script>
  const toggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('mobile-menu');
  toggle?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
</script>
